<div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <div class="mb-6">
    <a
      routerLink="/products"
      class="inline-flex items-center text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300"
    >
      <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
      </svg>
      Volver a la lista
    </a>
    <h1 class="mt-2 text-3xl font-bold text-gray-900 dark:text-white">
      {{ isEditMode() ? 'Editar Producto' : 'Nuevo Producto' }}
    </h1>
  </div>

  @if (initialLoading()) {
    <app-loading-spinner message="Cargando datos..." />
  } @else {
    <mat-card>
      <mat-card-content>
        <app-error-alert [message]="errorMessage()" (dismissed)="errorMessage.set('')" />

        <form [formGroup]="productForm" (ngSubmit)="onSubmit()">
          <div class="space-y-4">
            <!-- Name -->
            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Nombre del producto</mat-label>
              <input matInput formControlName="name" required />
              @if (productForm.get('name')?.hasError('required')) {
                <mat-error>El nombre es requerido</mat-error>
              }
              @if (productForm.get('name')?.hasError('maxlength')) {
                <mat-error>El nombre no puede tener más de 150 caracteres</mat-error>
              }
            </mat-form-field>

            <!-- SKU -->
            <mat-form-field appearance="outline" class="w-full">
              <mat-label>SKU</mat-label>
              <input matInput formControlName="sku" required />
              @if (productForm.get('sku')?.hasError('required')) {
                <mat-error>El SKU es requerido</mat-error>
              }
              @if (productForm.get('sku')?.hasError('minlength')) {
                <mat-error>El SKU debe tener al menos 3 caracteres</mat-error>
              }
              @if (productForm.get('sku')?.hasError('maxlength')) {
                <mat-error>El SKU no puede tener más de 50 caracteres</mat-error>
              }
            </mat-form-field>

            <!-- Price -->
            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Precio</mat-label>
              <span matTextPrefix>$&nbsp;</span>
              <input matInput type="number" formControlName="price" min="0" step="0.01" required />
              @if (productForm.get('price')?.hasError('required')) {
                <mat-error>El precio es requerido</mat-error>
              }
              @if (productForm.get('price')?.hasError('min')) {
                <mat-error>El precio debe ser mayor o igual a 0</mat-error>
              }
            </mat-form-field>

            <!-- Owner -->
            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Propietario (opcional)</mat-label>
              <mat-select formControlName="owner">
                <mat-option [value]="null">Sin propietario</mat-option>
                @if (loadingPersons()) {
                  <mat-option disabled>Cargando personas...</mat-option>
                } @else {
                  @for (person of persons(); track person.id) {
                    <mat-option [value]="person.id">
                      {{ person.first_name }} {{ person.last_name }} ({{ person.email }})
                    </mat-option>
                  }
                }
              </mat-select>
            </mat-form-field>

            <!-- Form Actions -->
            <div class="flex items-center justify-end gap-3 pt-4">
              <button mat-stroked-button type="button" routerLink="/products">
                Cancelar
              </button>
              <button
                mat-raised-button
                color="primary"
                type="submit"
                [disabled]="productForm.invalid || loading()"
              >
                @if (loading()) {
                  <mat-icon class="animate-spin">refresh</mat-icon>
                  Guardando...
                } @else {
                  {{ isEditMode() ? 'Actualizar' : 'Crear' }}
                }
              </button>
            </div>
          </div>
        </form>
      </mat-card-content>
    </mat-card>
  }
</div>

