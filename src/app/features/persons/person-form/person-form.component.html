<div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <div class="mb-6">
    <a
      routerLink="/persons"
      class="inline-flex items-center text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300"
    >
      <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
      </svg>
      Volver a la lista
    </a>
    <h1 class="mt-2 text-3xl font-bold text-gray-900 dark:text-white">
      {{ isEditMode() ? 'Editar Persona' : 'Nueva Persona' }}
    </h1>
  </div>

  @if (initialLoading()) {
    <app-loading-spinner message="Cargando datos..." />
  } @else {
    <mat-card>
      <mat-card-content>
        <app-error-alert [message]="errorMessage()" (dismissed)="errorMessage.set('')" />

        <form [formGroup]="personForm" (ngSubmit)="onSubmit()">
          <div class="space-y-4">
            <!-- First Name -->
            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Nombre</mat-label>
              <input matInput formControlName="first_name" required />
              @if (personForm.get('first_name')?.hasError('required')) {
                <mat-error>El nombre es requerido</mat-error>
              }
              @if (personForm.get('first_name')?.hasError('maxlength')) {
                <mat-error>El nombre no puede tener más de 100 caracteres</mat-error>
              }
            </mat-form-field>

            <!-- Last Name -->
            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Apellido</mat-label>
              <input matInput formControlName="last_name" required />
              @if (personForm.get('last_name')?.hasError('required')) {
                <mat-error>El apellido es requerido</mat-error>
              }
              @if (personForm.get('last_name')?.hasError('maxlength')) {
                <mat-error>El apellido no puede tener más de 100 caracteres</mat-error>
              }
            </mat-form-field>

            <!-- Email -->
            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Email</mat-label>
              <input matInput type="email" formControlName="email" required />
              @if (personForm.get('email')?.hasError('required')) {
                <mat-error>El email es requerido</mat-error>
              }
              @if (personForm.get('email')?.hasError('email')) {
                <mat-error>Por favor ingresa un email válido</mat-error>
              }
            </mat-form-field>

            <!-- Form Actions -->
            <div class="flex items-center justify-end gap-3 pt-4">
              <button mat-stroked-button type="button" routerLink="/persons">
                Cancelar
              </button>
              <button
                mat-raised-button
                color="primary"
                type="submit"
                [disabled]="personForm.invalid || loading()"
              >
                @if (loading()) {
                  <mat-icon class="animate-spin">refresh</mat-icon>
                  Guardando...
                } @else {
                  {{ isEditMode() ? 'Actualizar' : 'Crear' }}
                }
              </button>
            </div>
          </div>
        </form>
      </mat-card-content>
    </mat-card>
  }
</div>

